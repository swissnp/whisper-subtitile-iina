!function(){function e(e,r,t,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){t(e);return}s.done?r(u):Promise.resolve(u).then(n,i)}function r(r){return function(){var t=this,n=arguments;return new Promise(function(i,o){var a=r.apply(t,n);function s(r){e(a,i,o,s,u,"next",r)}function u(r){e(a,i,o,s,u,"throw",r)}s(void 0)})}}function t(e,r){var t,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){var c=[s,u];if(t)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(o=0)),o;)try{if(t=1,n&&(i=2&c[0]?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,n=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=r.call(e,o)}catch(e){c=[6,e],n=0}finally{t=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}"function"==typeof SuppressedError&&SuppressedError;var n=iina.event,i=iina.utils,o=iina.console,a=iina.file;function s(){r(function(){var e,r;return t(this,function(t){switch(t.label){case 0:if(!(e=function(){try{return i.resolvePath("@tmp/whisper_server.pid")}catch(e){return o.warn(`Unable to resolve PID file: ${e.message}`),null}}())||!a.exists(e))return[2];if(!Number.isFinite(r=parseInt((a.read(e)||"").trim(),10)))return c(e),[2];return[4,u(r,"-TERM")];case 1:return t.sent(),[4,new Promise(function(e){return setTimeout(e,200)})];case 2:return t.sent(),[4,u(r,"-KILL")];case 3:return t.sent(),c(e),[2]}})})().catch(function(e){o.warn(`Failed to cleanup whisper-server: ${e.message}`)})}function u(e,n){return r(function(){var r;return t(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,i.exec("/bin/kill",[n,`${e}`])];case 1:return t.sent(),[3,3];case 2:if(r=t.sent(),/No such process/i.test((null==r?void 0:r.message)||""))return[2];throw r;case 3:return[2]}})})()}function c(e){try{a.exists(e)&&a.delete(e)}catch(r){o.warn(`Unable to delete PID file ${e}: ${r.message}`)}}s(),n.on("iina.window-will-close",s),n.on("iina.window-did-close",s)}();
//# sourceMappingURL=global.js.map
